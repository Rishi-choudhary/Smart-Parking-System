{% extends "base.html" %}

{% block content %}



<!-- <div id="data-display"></div> -->

<form method="post" action="/reserve"  class="form">

<div class="container-fluid my-5" id="main-reservation">
<div class="parking-container">
    <div class="data-box container-fluid">
        <h3 class="m-para font-bold">Parking Status</h3>
        <p class="total-para">Total Seats:</p><span class="total-data">8</span>
        <p class="avail-para">Available: </p><span class="avail-data">2</span>
        <div class="location">
                <p>Your Location:</p><i class="fas fa-map-marker-alt"></i><p>Silvassa</p>
        </div>
    </div>
    <div class="display-box">
        {% for parking in total_parking %}

        {% if parking[2] in reserved%}
        <div class="lot-box inactive text-center" style="background-color: gray;">{{ parking[2] }} reserved </div>
        {% elif parking[2] in parking_list %} 
        <div  class="lot-box inactive">{{ parking[2] }}</div>
        {% else %}
        <div  class="lot-box">{{ parking[2] }}</div>
        {% endif %}
        {% endfor %}
        <input type="text" class="input d-none" name="parking_slot">
    </div>
    <div class="container-fluid row reserve-button">
        <button type="submit" onclick="sendData()" class="btn mb-5 mt-3 px-5 btn-primary">Book slot</button>
    </div>
</div>

</form>





<script>


    

   const seats = document.querySelectorAll('.lot-box');
   const parking_slot = document.getElementsByClassName("value")
    let selectedSeat = null;

    seats.forEach(seat => {
        seat.addEventListener('click', () => {
            if (seat.classList.contains('selected')) {
                alert('This seat is already booked.');
            } else {
                if (selectedSeat) {
                    selectedSeat.classList.remove('selected');
                }
                seat.classList.add('selected');
                selectedSeat = seat;
                parking_slot.value = selectedSeat.innerHTML
                console.log(parking_slot.value)
            }
        });
        
    }); 

    function sendData() {
        const inputValue =parking_slot.value;
        fetch('/bill', {
           method: 'POST',
           headers: {
             'Content-Type': 'application/json',
           },
           body: JSON.stringify({ data: inputValue }),
        })
        .then(response => response.json())
        .then(data => console.log('Success:', data))
        .catch((error) => console.error('Error:', error));
    }

      
</script>

{% endblock %}
    